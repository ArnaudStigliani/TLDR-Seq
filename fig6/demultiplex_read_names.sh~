#!/bin/bash


arg=$1
geno=$(basename $arg | sed 's/\.fastq\.gz//' | sed 's/.*_//')
echo $geno


data=../../results/sequencing_run_before_promethion2/$geno/pipeline_map/
results=../../results/sequencing_run_before_promethion2/$geno/demultiplex_read_names/

fastq=$data/trimming/trimmed.fastq.gz

mkdir -p $results


zcat $fastq |  sed -n 1~4p | awk '{print $1}' | awk -v FS="_" -v OFS="\t" '{print $1, $2, $3}' | sed 's/^@//'  > $results/reads_specifications.tsv

a=$(awk '{print $2}' $results/reads_specifications.tsv | sort | uniq)

echo -e "$a" | xargs -I {} --max-procs=13  bash -c  "awk -v bc={} '\$2==bc{print \$3}' $results/reads_specifications.tsv > $results/{}_reads.txt"



    


